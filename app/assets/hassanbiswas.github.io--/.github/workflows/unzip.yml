name: Unzip Assets Automation
on:
  push:
    branches: [ main ]

jobs:
  unzip-process:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Process Zips and Exclude Folders
        run: |
          # Automation Logic: Using date-based versioning
          VERSION=$(date +%d)
          echo "Running Unzip Version: $VERSION"

          # 1. Define Excluded Folders (3 Example folder names included)
          EXCLUDED_FOLDERS=(
            "node_modules"
            "src/temp-assets"
            "backup/old-layouts"
            "app"
          )

          # 2. Build the exclusion string for the find command
          # This creates a series of '-not -path "./folder/*"' arguments
          EXCLUDE_CMD=""
          for folder in "${EXCLUDED_FOLDERS[@]}"; do
            EXCLUDE_CMD+=" -not -path \"./$folder/*\""
          done

          # 3. Find and Unzip
          # Logic: Find .zip files, excluding the list, then unzip into folders
          eval "find . -type f -name '*.zip' $EXCLUDE_CMD" -print0 | while IFS= read -r -d '' file; do
            target_dir="${file%.*}"
            echo "Automating extraction of $file into $target_dir"
            mkdir -p "$target_dir"
            unzip -o "$file" -d "$target_dir"
          done

      - name: Commit changes
        run: |
          git config --local user.email "hassanbiswas.github.io@gmail.com"
          git config --local user.name "Hassan Biswas"
          git add .
          git commit -m "Automated Unzip - Version $VERSION [skip ci]" || echo "No changes to commit"
          git push
          
