name: Daily Automation Update

on:
  schedule:
    # Logic Automation: Runs every 3 hours (8 times daily)
    # 00:00, 03:00, 06:00, 09:00, 12:00, 15:00, 18:00, 21:00 UTC
    - cron: '0 */3 * * *'
  workflow_dispatch: # Allows manual trigger if needed

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: UI/UX Logic Preservation (Auto-Inject Version)
        run: |
          # Automation: Get current day for cache-busting (1-31)
          VERSION=$(date +%d)
          
          # Find and replace VERSION in JS files to ensure Logic Preservation
          # Matches: const VERSION = [anything];
          find . -name "*.js" -exec sed -i "s/const VERSION = .*;/const VERSION = $VERSION;/g" {} +
          
          # SVG Optimization: Ensure Chrome handles scaling perfectly with sizes="any"
          find . -name "*.html" -exec sed -i 's/<link rel="icon"\(.*\)>/<link rel="icon"\1 sizes="any">/g' {} +
          
          # Export VERSION for use in the next step's commit message
          echo "CURRENT_VERSION=$VERSION" >> $GITHUB_ENV

      - name: Force Re-deployment
        run: |
          # Fallback Security: Ensure git identifies as Hassan Biswas
          git config --local user.email "hassanbiswas.github.io@gmail.com"
          git config --local user.name "Hassan Biswas"
          
          # Logic Automation: Add changes and commit with Run ID and Version
          git add .
          git commit --allow-empty -m "Pulse [${{ github.run_id }}] - Version ${{ env.CURRENT_VERSION }}"
          git push
          
