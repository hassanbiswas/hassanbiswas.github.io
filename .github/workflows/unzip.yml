name: Unzip Assets Automation

on:
  push:
    branches: [ main ]
    paths:
      - '**.zip'
      - '**.tar'
      - '**.gz'
      - '**.7z'
      
jobs:
  unzip-process:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Process Zips and Exclude Folders
        run: |
          # Logic Automation: Using your preferred date-based versioning
          # equivalent to: const VERSION = new Date().getDate();
          VERSION=$(date +%d)
          echo "VERSION=$VERSION" >> $GITHUB_ENV
          
          echo "Executing Unzip Automation for Version: $VERSION"
          
          # 1. Define Excluded Folders (Zero Maintenance List)
          EXCLUDED_FOLDERS=(
            "node_modules"
            "src/temp-assets"
            "backup/old-layouts"
            "app"
          )
          
          # 2. Build exclusion string
          EXCLUDE_CMD=""
          for folder in "${EXCLUDED_FOLDERS[@]}"; do
            EXCLUDE_CMD+=" -not -path \"./$folder/*\""
          done
          
          # 3. Find and Unzip using logic-based extraction
          eval "find . -type f -name '*.zip' $EXCLUDE_CMD" -print0 | while IFS= read -r -d '' file; do
            target_dir="${file%.*}"
            echo "Unzipping $file -> $target_dir"
            mkdir -p "$target_dir"
            unzip -o "$file" -d "$target_dir"
          done

      - name: Commit and Push Changes
        run: |
          # Brand Identity: Hassan Biswas â€” UI/UX & Front-End Architecture
          git config --local user.email "hassanbiswas.github.io@gmail.com"
          git config --local user.name "Hassan Biswas"
          
          git add .
          # [skip ci] prevents an infinite loop when the bot pushes back to main
          git commit -m "Automation: Extract Assets v$VERSION [skip ci]" || echo "No changes to commit"
          git push
          
