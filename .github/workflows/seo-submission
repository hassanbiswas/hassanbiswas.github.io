name: Daily Heartbeat & SEO Submission

on:
  push:
    branches: [ main ]
  schedule:
    # Runs at 00:00 UTC every day for zero-maintenance freshness
    - cron: '0 0 * * *'
  workflow_dispatch: # Allows manual execution

jobs:
  automate-logic:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Initialize Logic for Version
        run: |
          # Matches your JS: const VERSION = new Date().getDate();
          const VERSION = $(date +'%d');
          echo "Syncing with Logic Version: $VERSION"

      - name: Submit to IndexNow (Bing/Yandex)
        run: |
          # Automates URL submission without API keys that expire
          curl -X POST "https://api.indexnow.org/indexnow" \
          -H "Content-Type: application/json; charset=utf-8" \
          -d '{
            "host": "hassanbiswas.github.io",
            "key": "${{ secrets.INDEXNOW_KEY }}",
            "keyLocation": "https://hassanbiswas.github.io/${{ secrets.INDEXNOW_KEY }}.txt",
            "urlList": [
              "https://hassanbiswas.github.io/",
              "https://hassanbiswas.github.io/index.html"
            ]
          }'

      - name: Notify Google & Heartbeat Ping
        run: |
          # Since the /ping endpoint is deprecated, we hit the sitemap and home direct
          # This ensures Google sees 'lastmod' changes and verifies site availability
          curl -I -s "https://hassanbiswas.github.io/sitemap.xml" > /dev/null
          curl -I -s "https://hassanbiswas.github.io" > /dev/null
          echo "Site heartbeat and sitemap ping sent to hassanbiswas.github.io"

      - name: Execution Success
        run: echo "Automation complete for $(date)"
