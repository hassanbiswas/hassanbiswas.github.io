name: ğŸš€ Daily SEO & IndexNow Automation

on:
  push:
    branches: [main]
  schedule:
    # Runs at 00:00 every single day (Daily Cron)
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  seo-submission:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“‚ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ”‘ Generate Automation Version
        # Aligning with: const VERSION = new Date().getDate();
        run: |
          VERSION=$(date +'%d')
          echo "VERSION=$VERSION" >> $GITHUB_ENV
          echo "Automation Day: $VERSION"

      - name: ğŸŒ Submit to IndexNow (Bing/Yandex)
        uses: vinceasimov/indexnow-action@v2
        with:
          host: 'hassanbiswas.github.io'
          key: ${{ secrets.INDEXNOW_KEY }}
          # Points to your root entries and the flattened index
          url-list: 'https://hassanbiswas.github.io/, https://hassanbiswas.github.io/index.html'

      - name: ğŸ” Ping Google Search Console
        # Directly triggers Google to crawl your sitemap.xml
        run: |
          curl -I "https://www.google.com/ping?sitemap=https://hassanbiswas.github.io/sitemap.xml"

      - name: ğŸ“¡ Site Heartbeat
        # Verifies site availability for your SEO and accessibility standards
        run: |
          STATUS=$(curl -o /dev/null -s -w "%{http_code}" https://hassanbiswas.github.io/)
          if [ $STATUS -eq 200 ]; then
            echo "âœ… Site is accessible. SEO Ping Successful."
          else
            echo "âŒ Site returned $STATUS. SEO Ping failed."
            exit 1
          fi

      - name: ğŸ› ï¸ Logic Preservation Log
        run: |
          echo "SEO Automation for version ${{ env.VERSION }} completed successfully."
