name: Automated Compression & Logic Preservation
on:
  push:
    branches:
      - main
    paths:
      - '**'
      - '**/*.zip'
      - '**/*.7z'
      - '**/*.tar'
      - '**/*.gz'
      - '**/*.rar'
  # Zero Maintenance: Automates refresh twice a month
  schedule:
    - cron: '0 0 1,15 * *'
  workflow_dispatch: 

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Execute Logic Preservation
        run: |
          # Automation: Match the JS Date().getDate() logic
          VERSION=$(date +%d)
          echo "VERSION=$VERSION" >> $GITHUB_ENV
          
          # Extraction logic (Auto-unzip)
          # Finds all archives, excluding core architecture
          find . -type f \( -name "*.zip" -o -name "*.7z" -o -name "*.tar" \) \
          -not -path "./.git/*" -not -path "./.github/*" | while read -r file; do
            echo "Processing $file..."
            if [[ "$file" == *.zip ]]; then unzip -o "$file" -d ./;
            elif [[ "$file" == *.7z ]]; then 7z x "$file" -y;
            fi
          done

      - name: Inject Brand & Version
        run: |
          # Logic Preservation: Update VERSION in all JS files
          find . -name "*.js" -exec sed -i "s/const VERSION = .*/const VERSION = ${VERSION};/g" {} +
          
          # Setting Brand Identity HSL(240, 80%, 50%)
          echo "BRAND_COLOR='hsl(240, 80%, 50%)'" >> $GITHUB_ENV

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4
